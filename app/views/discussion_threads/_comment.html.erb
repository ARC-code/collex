<%
    # ------------------------------------------------------------------------
    # Copyright 2009 Applied Research in Patacriticism and the University of Virginia
    #
    # Licensed under the Apache License, Version 2.0 (the "License");
    # you may not use this file except in compliance with the License.
    # You may obtain a copy of the License at
    #
    #    http://www.apache.org/licenses/LICENSE-2.0
  
    # Unless required by applicable law or agreed to in writing, software
    # distributed under the License is distributed on an "AS IS" BASIS,
    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    # See the License for the specific language governing permissions and
    # limitations under the License.
    # ---------------------------------------------------------------------------- -%>
<% # params: ActiveRecord comment, int thread_id, bool thread_link (whether to display the go to thread link), bool can_delete -%>

<table class="discussion_thread_list">
	<% if comment.reported == 1 && can_delete -%>
	<tr valign="top">
		<td colspan="4">
			<div class="reported_comment">
			NOTICE: This comment has been reported as objectionable by <%= user.fullname %>, and is pending moderation.
			</div>
		</td>
	</tr>
	<% end -%>
	<tr valign="top">
		<% if comment.get_type() == "comment" -%>
			<td><%= render :partial => 'users_picture', :locals => { :user_id => comment.user_id } %></td>
			<td>
				<%= link_to "[go to thread]", "/discussion_threads/view_thread?thread=#{thread_id}", :class => 'nav_link' if thread_link %>
				<%= link_to '[delete]', "/discussion_threads/delete_comment?comment=#{comment.id}", :confirm => 'Are you sure?', :method => :delete, :class => 'modify_link' if can_delete %>
				<h3><%= DiscussionThread.find(thread_id).title %></h3>
				<%=h comment.comment %>
				<%= render :partial => 'comment_footer', :locals => { :comment => comment } %>
			</td>
		<% elsif comment.get_type() == "nines_object" -%>
			<% hit = CachedResource.get_hit_from_resource_id(comment.cached_resource_id) -%>
			<%= render :partial => '/results/result_row', :locals => { :row_id => "test", :index => 2, :hit => hit, :has_exhibits => false } %>
			<td>
				<%= "<div class='discourse_msg'>#{User.find(comment.user_id).fullname} has added the following object to the discourse…" if comment.position > 1 %>
				<%= link_to "[go to thread]", "/discussion_threads/view_thread?thread=#{thread_id}", :class => 'nav_link' if thread_link %>
				<%= link_to '[delete]', "/discussion_threads/delete_comment?comment=#{comment.id}", :confirm => 'Are you sure?', :method => :delete, :class => 'modify_link' if can_delete %>
				<%= render :partial => 'comment_footer', :locals => { :comment => comment } %></td>
		<% elsif comment.get_type() == "nines_exhibit" -%>
			<% exhibit = Exhibit.find(comment.exhibit_id) -%>
			<td><img src="<%= exhibit.thumbnail %>" alt="exhibit" /></td>
			<td>
				<%= "<div class='discourse_msg'>#{User.find(comment.user_id).fullname} has added the following object to the discourse…" if comment.position > 1 %>
				<%= link_to "[go to thread]", "/discussion_threads/view_thread?thread=#{thread_id}", :class => 'nav_link'  if thread_link %>
				<%= link_to '[delete]', "/discussion_threads/delete_comment?comment=#{comment.id}", :confirm => 'Are you sure?', :method => :delete, :class => 'modify_link' if can_delete %>
				<h3><%=h exhibit.title %></h3>
				<%= render :partial => 'comment_footer', :locals => { :comment => comment } %>
			</td>
		<% elsif comment.get_type() == "inet_object" -%>
			<td><img src="<%= comment.image_url %>" alt="thumbnail" /></td>
			<td>
				<%= "<div class='discourse_msg'>#{User.find(comment.user_id).fullname} has added the following object to the discourse…" if comment.position > 1 %>
				<%= link_to "[go to thread]", "/discussion_threads/view_thread?thread=#{thread_id}", :class => 'nav_link'  if thread_link %>
				<%= link_to '[delete]', "/discussion_threads/delete_comment?comment=#{comment.id}", :confirm => 'Are you sure?', :method => :delete, :class => 'modify_link' if can_delete %>
				<a class="ext_link" target="_blank" href="<%= comment.link_url %>" ><%=h comment.link_url %></a>
				<p><%=h comment.comment %></p>
				<%= render :partial => 'comment_footer', :locals => { :comment => comment } %>
			</td>
		<% else -%>
			<td>ERROR: ill-formed comment. (Comment type <%- comment.comment_type %> is unknown)</td>
		<% end -%>
	</tr>
</table>
