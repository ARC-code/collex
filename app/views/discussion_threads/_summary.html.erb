<%
    # ------------------------------------------------------------------------
    # Copyright 2009 Applied Research in Patacriticism and the University of Virginia
    #
    # Licensed under the Apache License, Version 2.0 (the "License");
    # you may not use this file except in compliance with the License.
    # You may obtain a copy of the License at
    #
    #    http://www.apache.org/licenses/LICENSE-2.0
  
    # Unless required by applicable law or agreed to in writing, software
    # distributed under the License is distributed on an "AS IS" BASIS,
    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    # See the License for the specific language governing permissions and
    # limitations under the License.
    # ---------------------------------------------------------------------------- -%>
<% # summary: params: ActiveRecord comment, int thread_id, bool can_delete -%>
<% if comment.get_type() == "comment" -%>
	<% title = DiscussionThread.find(thread_id).title -%>
	<% thumbnail = get_user_picture(comment.user_id, :thumb) -%>
<% elsif comment.get_type() == "nines_object" -%>
	<% hit = CachedResource.get_hit_from_resource_id(comment.cached_resource_id) -%>
	<% title = h hit["title"][0] -%>
	<% thumbnail = get_image_url(CachedResource.get_thumbnail_from_hit(hit)) -%>
<% elsif comment.get_type() == "nines_exhibit" -%>
	<% exhibit = Exhibit.find(comment.exhibit_id) -%>
	<% title = h exhibit.title -%>
	<% thumbnail = exhibit.thumbnail -%>
<% elsif comment.get_type() == "inet_object" -%>
	<% title = h comment.link_url -%>
	<% thumbnail = comment.image_url -%>
<% else -%>
	<% title = "ERROR: ill-formed comment. (Comment type #{ comment.comment_type } is unknown)" -%>
	<% thumbnail = "" -%>
<% end -%>
<div class="discussion_summary">
	<%= render :partial => 'img_with_progress_spinner', :locals => { :src => thumbnail, :alt => 'thumbnail' } %>
	<% if comment.reported == 1 && can_delete -%>
		<div class="reported_comment">
			NOTICE: This comment has been reported as objectionable by <%= user.fullname %>, and is pending moderation.
		</div>
	<% end -%>
	<div class="discussion_summary_title">
		<%= link_to title, "/discussion_threads/view_thread?thread=#{thread_id}", :class => 'nav_link' %>
	</div>
	<%= render :partial => 'comment_footer', :locals => { :comment => comment, :include_username => true, :include_report => false, :include_last_updated => true } %>
</div>
