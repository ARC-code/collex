<div id="logged_in_user_options">
	<%= link_to("[Edit this exhibit]", :controller => 'my9s', :action => 'edit_exhibit', :id => @exhibit.id ) if is_logged_in? && @exhibit.user_id == User.find_by_username(session[:user][:username]).id  %>
</div>
<div id="exhibit_page">
	<h2 class="exhibit_title" ><%= @exhibit.title %></h2>
	<h3 class="exhibit_author" ><%= User.find(@exhibit.user_id).fullname %></h3>
	<% num_pages = @exhibit.exhibit_pages.length -%>
	<% if num_pages > 0 -%>
		<%= render :partial => 'pagination', :locals => { :curr_page => @page, :num_pages => num_pages, :id => @exhibit.id, :action => 'view' } %>
		<% page = @exhibit.exhibit_pages[@page-1] -%>
		<% has_border = false -%>
		<% elements = page.exhibit_elements -%>
		<% for element in elements -%>
		<% is_first = true -%>
			<div class="exhibit_section_with_border">
				<% if element.exhibit_element_layout_type == 'header' -%>
					<%= render :partial => 'exhibit_header', :locals => { :text => element.element_text, :id => element.id } %>
				<% elsif element.exhibit_element_layout_type == 'text' -%>
					<%= render :partial => 'exhibit_text', :locals => { :text => element.element_text, :is_first => is_first } %>
				<% elsif element.exhibit_element_layout_type == 'pic_text' -%>
					<% illustration = element.exhibit_illustrations.find(:first) -%>
					<table><tr>
						<td><%= render :partial => 'illustration', :locals => { :illustration => illustration } %></td>
						<td><%= render :partial => 'exhibit_text', :locals => { :text => element.element_text, :is_first => is_first } %></td>
					</tr></table>
				<% elsif element.exhibit_element_layout_type == 'text_pic' -%>
					<% illustration = element.exhibit_illustrations.find(:first) -%>
					<table><tr>
						<td><%= render :partial => 'exhibit_text', :locals => { :text => element.element_text, :is_first => is_first } %></td>
						<td><%= render :partial => 'illustration', :locals => { :illustration => illustration } %></td>
					</tr></table>
				<% elsif element.exhibit_element_layout_type == 'pics' -%>
					<% pics = element.exhibit_illustrations -%>
					<table><tr>
						<% for pic in pics -%>
						<td><%= render :partial => 'illustration', :locals => { :illustration => pic } %></td>
						<% end -%>
					</tr></table>
				<% else -%>
					Unknown element type:
					<%= element.exhibit_element_layout_type %><br />
				<% end -%>
				<% is_first = false -%>
			</div>
		<% end # for element in elements -%>
	<br />
	<% if @page < num_pages -%>
		<div class="exhibit_nextlink">
		<%= link_to "next &raquo;", :action => 'view', :id => @exhibit.id, :page => @page + 1 %>
		</div>
	<% end -%>
<% end #if there are pages defined -%>
</div>

