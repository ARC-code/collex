<% # 
    # ------------------------------------------------------------------------
    # Copyright 2009 Applied Research in Patacriticism and the University of Virginia
    #
    # Licensed under the Apache License, Version 2.0 (the "License");
    # you may not use this file except in compliance with the License.
    # You may obtain a copy of the License at
    #
    #    http://www.apache.org/licenses/LICENSE-2.0
  
    # Unless required by applicable law or agreed to in writing, software
    # distributed under the License is distributed on an "AS IS" BASIS,
    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    # See the License for the specific language governing permissions and
    # limitations under the License.
    # ---------------------------------------------------------------------------- -%>
<%# group_discussions_list : parameters: ActiveRecord group, ActiveRecord cluster, int user_id -%>
<%# if cluster is nil, then this is the group page, otherwise it is the cluster page -%>
<% cluster ||= nil -%>
<div class="group_header">Discussions</div>
<% threads = DiscussionThread.find_all_by_group_id(group.id) if cluster == nil -%>
<% threads = DiscussionThread.find_all_by_cluster_id(cluster.id) if cluster != nil -%>
	<ul class="group_link_list">
<% if !group.can_read_forum(user_id) -%>
	<div class="empty_list_text" >You must be a member of this group to see its discussions.</div>
<% else -%>
	<%= "<li class='change_forum_permissions'>#{link_to_function('[change forum permissions]', "editPermissions(#{group.id}, gGroupData.forum_permissions, #{Group.permissions_to_json()}, #{Group.permission_explanations_to_json()});", :class => 'nav_link')}</li>" if group.can_edit(user_id) %>
	<% if threads.length == 0 -%>
			<div class="empty_list_text" >There have been no discussions started in this <%= cluster == nil ? "group" : "cluster"  %>.</div>
		<% else -%>
		<% for thread in threads -%>
			<li><%= link_to(thread.get_title(), { :controller => 'forum', :action => 'view_thread', :thread => thread.id }, :class => 'nav_link') %></li>
		<% end -%>
	<% end -%>
	<%= "<li class='group_new_post'>#{link_to_function("[ New Post ]", "new GroupNewPost('#{PROGRESS_SPINNER_PATH}',#{group.id}, gGroupData.name,  #{is_logged_in?}); return false;", :class => "nav_link" )}</li>" if group.can_post(user_id) %>
<% end -%>
	</ul>
