<% #
    # ------------------------------------------------------------------------
    # Copyright 2009 Applied Research in Patacriticism and the University of Virginia
    #
    # Licensed under the Apache License, Version 2.0 (the "License");
    # you may not use this file except in compliance with the License.
    # You may obtain a copy of the License at
    #
    #    http://www.apache.org/licenses/LICENSE-2.0

    # Unless required by applicable law or agreed to in writing, software
    # distributed under the License is distributed on an "AS IS" BASIS,
    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    # See the License for the specific language governing permissions and
    # limitations under the License.
    # ---------------------------------------------------------------------------- -%>
<% current_page "News" -%>

<div id="installation-instructions">
	<h2><%= Setup.site_name() %> News Installation</h2>
		
	<p><%= Setup.site_name() %> News is powered by WordPress which is integrated with the Ruby on Rails application. There are a number of ways to do this; the following discussion assumes the server is running Apache with Passenger.</p>

<h3>System Dependencies</h3>

<p>ssh access to the server, Apache 2, Phusion Passenger, PHP, mysql.</p>

<h3>Step One: Install WordPress</h3>

<p>You can obtain the latest version of WordPress <a href="http://wordpress.org/download/">here</a>. Install WordPress anywhere on the same server as the <%= Setup.site_name() %> installation.
	For instance, if all of your websites are located at ~/www do this:
<pre>
cd ~/www
wget http://wordpress.org/latest.tar.gz
tar xvfz latest.tar.gz
mv wordpress wp_<%= Setup.site_name() %>
cd wp_<%= Setup.site_name() %>/
cp wp-config-sample.php wp-config.php
vi wp-config.php
# set the credentials for the database access.

mysql -u username -p
CREATE DATABASE wp_<%= Setup.site_name() %>;
CREATE USER 'username'@'localhost' IDENTIFIED BY 'super-secret';
GRANT ALL ON wp_<%= Setup.site_name() %>.* TO 'username'@'localhost';
</pre>
</p>
<h3>Step Two: Modify Apache Config</h3>
<p>Put this in your apache configuration file to get Passenger to ignore requests from the /news folder:</p>
<pre>
&lt;Directory "/path/to/rails/app/public/news"&gt;
    PassengerEnabled off
    AllowOverride all
&lt;/Directory&gt;
</pre>

<h3>Step Three: Link the blog to <%= Setup.site_name() %></h3>
	<p>Put in a symbolic link in your Rails app so that requests for /news get redirected to WordPress:</p>
	<pre>
cd path/to/rails/app/public
ln -s /path/to/wordpress/installation news
	</pre>

	<div class="instructions-note"><p>NOTE: Once these rules are in place, this page of instructions will be replaced with WordPress. You can still access this page of instructions <a href="/home/news/">here</a>.</p></div>

<h3>Step Four: Activate Wordpress</h3>

<p>Point your browser to http://your-domain.com/news. You should get instructions from WordPress about setting up the blog. Note that you should NOT do this step before you get the
symbolic link set up. WordPress needs to have the correct URL to function properly.</p>

<h3>Step Five: Install the Collex Theme and Plugin</h3>
	<p>Install the generic Collex theme from <a href="https://github.com/collex/collex_wordpress_theme">here</a> by downloading the code to the wp-content/themes folder.
		Select the theme from the WordPress administration panel.
	</p>
	<p>Install the Rails Theme plugin by going to the plugin page and searching for "Rails Theme". After activating the plugin, go to the Settings/Rails Theme page and enter the URL for <%= Setup.site_name() %>.</p>

</div>