<%
    # ------------------------------------------------------------------------
    # Copyright 2009 Applied Research in Patacriticism and the University of Virginia
    #
    # Licensed under the Apache License, Version 2.0 (the "License");
    # you may not use this file except in compliance with the License.
    # You may obtain a copy of the License at
    #
    #    http://www.apache.org/licenses/LICENSE-2.0
  
    # Unless required by applicable law or agreed to in writing, software
    # distributed under the License is distributed on an "AS IS" BASIS,
    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    # See the License for the specific language governing permissions and
    # limitations under the License.
    # ---------------------------------------------------------------------------- -%>
	
<% element_count = 1 -%>
Editing Page: <span id="current_page_num"><%= page.position %></span>

<div id="current_page" style="display:none;"><%= page.id %></div>

<div class="edit_exhibit_box edit_exhibit_section_box">

	<div class="inside_edit_exhibit_box">
		<% is_first = true -%>
		<% ajax_action = "'/my9s/edit_element,/my9s/refresh_outline'" -%>
		<% ajax_div_id = "'edit_exhibit_page,full-window-content'" -%>
		<% for element in page.exhibit_elements -%>
			<% ajax_params = "'page=#{page.id}&element=#{element.position}&verb='" -%>
			<div class="edit_exhibit_box edit_exhibit_box_no_border">
				<h1>
					<div class="outline_right_controls">
						<%= link_to_function( "[outline]", "showExhibitOutline(#{element.id}, #{page.position});", { :title => 'Show Outline', :class => 'nav_link' }) %>
						<%= link_to_function( up_char(), "doAjaxLink(#{ajax_div_id}, #{ajax_action}, #{ajax_params}+'up');", { :title => 'Move Element Up', :class => 'modify_link' }) if element.position > 1 %>
						<%= link_to_function( down_char(), "doAjaxLink(#{ajax_div_id}, #{ajax_action}, #{ajax_params}+'down');", { :title => 'Move Element Down', :class => 'modify_link' }) if element.position < page.exhibit_elements.length %>
						<% if page.exhibit_elements.length > 1 -%>
							<span class="close_link"><%= link_to_function del_char(), "doAjaxLinkConfirm(#{ajax_div_id}, #{ajax_action}, #{ajax_params}+'delete');", { :title => 'Delete Element', :class => 'modify_link' } %></span>
						<% end -%>
					</div>
					<a id="top-of-<%= element.id %>" name="top-of-<%= element.id %>">
						<span class="edit_exhibit_element_number"><%= element_count %></span>
						<% element_count = element_count + 1 -%>
					</a>
					<select class="select_element_type" onchange='elementTypeChanged("element_<%= element.id %>", <%= element.id %>, this.options[this.selectedIndex].value);'>
					<option <%= "selected='selected'" if element.exhibit_element_layout_type == 'header' %> value="header">Header</option>
					<option <%= "selected='selected'" if element.exhibit_element_layout_type == 'text' %> value="text">Text</option>
					<option <%= "selected='selected'" if element.exhibit_element_layout_type == 'pic_text' %> value="pic_text">Illustration then Text</option>
					<option <%= "selected='selected'" if element.exhibit_element_layout_type == 'text_pic' %> value="text_pic">Text then Illustration</option>
					<option <%= "selected='selected'" if element.exhibit_element_layout_type == 'pics' %> value="pics">Row of Illustrations</option>
					</select>
					<% if element.exhibit_element_layout_type == 'pics' %>
						<% style = "" -%>
					<% else -%>
						<% style = "display: none;" -%>
					<% end -%>
					<% ill_ajax_action = "'/my9s/insert_illustration,/my9s/refresh_outline'" -%>
					<% ill_ajax_div_id = "'element_#{element.id},full-window-content'" -%>
					<% illustration_pos = element.exhibit_illustrations.length+1 -%>
					<% ill_ajax_params = "'element_id=#{element.id}&position=-1'" -%>
					<%= link_to_function("[add resource]", "doAjaxLink(#{ill_ajax_div_id}, #{ill_ajax_action}, #{ill_ajax_params});", { :id => "add_image_#{element.id}", :title => 'Append New Illustration To End', :class => 'modify_link', :style => style }) %>
				</h1>
				<div id="element_<%= element.id %>" class="inside_edit_exhibit_box element_block">
					<%= render :partial => 'edit_exhibit_element', :locals => { :element => element } %>
				</div> <% # Editing Element inner box %>
			</div> <% # Editing Element outer box %>
		<% end # for each element -%>
		
	</div> <% # Editing Section inner box %>
</div>

<% if top != nil -%>
<script language="JavaScript">
	var target_el = "target_" + <%= top %>;
	var element_el= "element_" + <%= top %>;
	scroll_to_target(target_el, element_el);
</script>
<% end -%>

