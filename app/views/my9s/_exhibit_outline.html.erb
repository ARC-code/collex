
<div id="full-window-content">
<div id="outline-toolbar">
<%= link_to_function("[New Section]", "doAjaxLinkOnSelection('insert_element', #{exhibit.id} );", { :title => 'New Section' }) %>
<%= link_to_function("[New Page]", "doAjaxLinkOnSelection('insert_page', #{exhibit.id} );", { :title => 'New Page' }) %>
<%= link_to_function("[Edit Border]", "doEnterEditBorder(#{exhibit.id} );", { :title => 'Edit the border surrounding the selected section', :id => 'edit_border' }) %>
</div>

<div id="border_controls" class="border_controls" style="display: none; text-align:right;" >
	<%= link_to_function(up_char(), "doAjaxLinkOnSelection('move_top_of_border_up', #{exhibit.id} );", { :title => 'Move Top of Border Up' }) %>
	<%= link_to_function(down_char(), "doAjaxLinkOnSelection('move_top_of_border_down', #{exhibit.id} );", { :title => 'Move Top of Border Down' }) %>
	<span class="close_link"><%= link_to_function(del_char(), "doAjaxLinkOnSelection('delete_border', #{exhibit.id} );", { :title => 'Delete Border' }) %></span>
</div>

<div id="border_controls_bottom" class="border_controls" style="display: none; text-align:right;" >
	<%= link_to_function(up_char(), "doAjaxLinkOnSelection('move_bottom_of_border_up', #{exhibit.id} );", { :title => 'Move Bottom of Border Up' }) %>
	<%= link_to_function(down_char(), "doAjaxLinkOnSelection('move_bottom_of_border_down', #{exhibit.id} );", { :title => 'Move Bottom of Border Down' }) %>
</div>
	
<ul id="exhibit_outline" class="outline_tree">
	<% is_first = true -%>
<% for page in exhibit.exhibit_pages -%>
	<% element_count = 1 -%>
	<li id='outline_page_<%= "#{page.position}" %>' class="unselected_page"><%= tree_node( "#{page.position}", "outline", "exhibit_outline_text", "toggle_by_id", exhibit.id, exhibit.exhibit_pages.length, :open ) %></li>
	<ul id='outline_<%= "p#{page.position}" %>' class="outline_tree_elements">
	<% border_active = false -%>
	<% if page.exhibit_elements.length == 0 -%>
		<% ajax_actions = "/my9s/modify_outline_add_first_element,/my9s/redraw_exhibit_page" -%>
		<% ajax_div = "full-window-content,edit_exhibit_page" -%>
		<%= link_to_function("[New Section]", "doAjaxLink('#{ajax_div}', '#{ajax_actions}', { page: #{page.id} } );", { :title => 'New Section' }) %>
	<% end #if there are no elements on this page -%>
	<% for element in page.exhibit_elements -%>
		<% ret = create_border_div(element, border_active, "outline_section_with_border") %>
		<%= ret[:html] %>
		<% border_active = ret[:border_active] -%>
			<li class="outline_element<%= " outline_tree_element_selected" if (is_first == true && element_id_selected.to_i == -1) || (element_id_selected.to_i == element.id.to_i) %>" id='outline_element_<%= element.id %>'>
					<div class="outline_right_controls">
						<% if page.position > 1 || element.position > 1 -%>
							<%= link_to_function(up_char(), "doAjaxLinkOnSelection('move_element_up', #{exhibit.id} );", { :title => 'Move Element Up' }) %>
						<% end -%>
						<% if page.position < exhibit.exhibit_pages.length || element.position < page.exhibit_elements.length -%>
							<%= link_to_function(down_char(), "doAjaxLinkOnSelection('move_element_down', #{exhibit.id} );", { :title => 'Move Element Down' }) %>
						<% end -%>
						&nbsp;<span class="close_link"><%= link_to_function(del_char(), "doAjaxLinkOnSelection('delete_element', #{exhibit.id} );", { :title => 'Delete Element' }) %></span>
					</div>
				<span class="count"><%= link_to_function "#{element_count}", "selectLine('outline_element_#{element.id}')" %></span>
				<% element_count = element_count + 1 -%>
				<% is_first = false -%>
				<span onclick="selectLine('outline_element_<%= element.id %>')">
				<% if element.exhibit_element_layout_type == 'text' -%>
					<%= element_text_thumbnail(element) %>
				<% elsif element.exhibit_element_layout_type == 'header' -%>
					<span class="exhibit_outline_header"><b><big><%=h strip_tags(element.element_text) %></big></b></span>
				<% elsif element.exhibit_element_layout_type == 'pics' -%>
					<% illustrations = element.exhibit_illustrations -%>
					<%= "[Row of illustrations: none specified]" if illustrations.length == 0 %>
					<% for illustration in illustrations -%>
					<%= element_pic_thumbnail_illustration(illustration) %>
					<% end -%>
				<% elsif element.exhibit_element_layout_type == 'pic_text' -%>
					<%= element_pic_thumbnail(element) %>
					<%= element_text_thumbnail(element) %>
				<% elsif element.exhibit_element_layout_type == 'text_pic' -%>
					<%= element_text_thumbnail(element) %>
					<%= element_pic_thumbnail(element) %>
				<% else -%>
					Error: unknown type
				<% end # type of element -%>
				</span>
			</li>
	<% end # each element -%>
	<%= '</div>' if border_active %>
	</ul>
<% end # each page -%>
</ul>
</div>

<% if is_editing_border -%>
<script language="JavaScript">
	doEnterEditBorder(<%=exhibit.id%>);
</script>
<% end -%>