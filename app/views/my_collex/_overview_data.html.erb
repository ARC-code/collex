<% #
    # ------------------------------------------------------------------------
    # Copyright 2009 Applied Research in Patacriticism and the University of Virginia
    #
    # Licensed under the Apache License, Version 2.0 (the "License");
    # you may not use this file except in compliance with the License.
    # You may obtain a copy of the License at
    #
    #    http://www.apache.org/licenses/LICENSE-2.0
  
    # Unless required by applicable law or agreed to in writing, software
    # distributed under the License is distributed on an "AS IS" BASIS,
    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    # See the License for the specific language governing permissions and
    # limitations under the License.
    # ---------------------------------------------------------------------------- -%>
<%#parameters: Exhibit exhibit; bool show_immediately -%>
<script type="text/javascript">
	var gGenres = <%= Branding.valid_genre_list().sort.to_json() %>;
</script>
<div id="global_form" class="inside_edit_exhibit_box">
	<div class="exhibit_profile">Exhibit Profile <%= link_to_function("[Edit Profile]", "editExhibitProfile('overview_data', #{exhibit.id}, 'overview_field', '/forum/get_nines_obj_list', '/forum/get_nines_obj_list_with_image?exhibit_id=#{exhibit.id}', '/images/ajax_loader.gif', gGenres); return false;", { :class => 'modify_link' }) %></div>
	<span class='exhibit_profile_comment'>Use the fields below to change the font styles, thumbnails or Creative Commons License for your exhibit</span>
	<div class="exhibit_preview_thumbnail"><%= render :partial => 'exhibits/exhibit_thumbnail', :locals => { :exhibit => exhibit, :show_immediately => show_immediately } %></div>
	<div class="exhibit_profile_preview">
		<div><span class="exhibit_profile_label">Style: </span>
			<% if Group.can_change_styles(exhibit) -%>
			<%= exhibit_builder_style_name(exhibit) %> <%= link_to_function("[select style]", "new EditFontsDlg('/my_collex/update_fonts', #{exhibit.id}, #{exhibit.to_json()}.exhibit, 'exhibit', false)", { :class => 'modify_link' }) %>
			<% else -%>
			Styles are set by the group.
			<% end -%>
		</div>
		<div><span class="exhibit_profile_label">Visible URL:</span>
			http://<%= request.host_with_port() %>/exhibits/<%= exhibit.get_id_if_no_visible_url() %><span id="overview_visible_url" class="overview_field"><%= exhibit.visible_url %></span></div>
		<span class="exhibit_profile_label">Thumbnail:</span>
		<span id="overview_thumbnail" class="overview_field"><%= exhibit.thumbnail && exhibit.thumbnail.length > 0 ? exhibit.thumbnail : "</span><span class='exhibit_profile_comment'>You have not added a thumbnail to this exhibit." %></span>
		<div>
			<span class="exhibit_profile_label">Short Title:</span>
			<span id="overview_resource_name" class="overview_field"><%= exhibit.resource_name %></span>
		</div>
		<div>
			<span class="exhibit_profile_label">Genres:</span>
			<span id="overview_genres" class="overview_field"><%= exhibit.genres %></span>
		</div>
<% if BLEEDING_EDGE == true -%>
		<% has_groups = Group.user_is_in_group(get_curr_user_id()) -%>
		<% none_text = has_groups ? 'No Group Selected' : 'You are not in any groups' -%>
		<% group_name = exhibit.group_id ? link_to(Group.find(exhibit.group_id).name, { :controller => 'groups', :action => 'show', :id => exhibit.group_id }, { :class => 'nav_link'}) : none_text -%>
		<% users_groups = [{ :value => '', :text => none_text }] -%>
		<% my_groups = Group.get_all_users_groups(exhibit.user_id) -%>
		<% for group in my_groups -%>
		<% users_groups.push({ :value => "#{group.id}", :text => group.name }) -%>
		<% end  -%>
		<span class="exhibit_profile_label">Group: </span><span id="overview_group" class="overview_field"><%= group_name %>&nbsp;<%= link_to_function("[select group]", "selectGroup(#{exhibit.id}, #{users_groups.to_json()}, '#{exhibit.group_id}');", { :class => 'modify_link' }) if has_groups %></span>
	<% if exhibit.group_id && Cluster.find_by_group_id(exhibit.group_id) != nil -%>
		<div>
		<% cluster_name = exhibit.cluster_id ? link_to(Cluster.find(exhibit.cluster_id).name, { :controller => 'clusters', :action => 'show', :id => exhibit.cluster_id }, { :class => 'nav_link'}) : "No Cluster Selected" -%>
		<% groups_clusters = [{ :value => '', :text => "No Cluster Selected" }] -%>
		<% clusters = Cluster.find_all_by_group_id(exhibit.group_id) -%>
		<% for cluster in clusters -%>
		<% groups_clusters.push({ :value => "#{cluster.id}", :text => cluster.name }) -%>
		<% end  -%>
		<span class="exhibit_profile_label">Cluster: </span><span id="overview_cluster" class="overview_field"><%= cluster_name %>&nbsp;<%= link_to_function("[select cluster]", "selectCluster(#{exhibit.id}, #{groups_clusters.to_json()}, '#{exhibit.cluster_id}');", { :class => 'modify_link' }) %></span>
		</div>
	<% end  -%>
<% end  -%>
		<div>
<% if BLEEDING_EDGE == true && Group.is_peer_reviewed_group(exhibit) -%>
			<%= exhibit.is_published == 1 ? "This exhibit is visible to everyone." : exhibit.is_published == 2 ? "Submitted for peer-review" : "Access to this exhibit is restricted to you." %>&nbsp;
			<%= link_to_function exhibit.is_published != 0 ? "[Unpublish]" : "[Submit for peer review]", "doPublish(#{exhibit.id}, #{exhibit.is_published != 0 ? 0 : 2});", :class => 'nav_link' %>
<% else  -%>
			<%= exhibit.is_published == 1 ? "This exhibit is visible to everyone." : "Access to this exhibit is restricted to you." %>&nbsp;
			<%= link_to_function exhibit.is_published == 1 ? "[Unpublish]" : "[Publish]", "doPublish(#{exhibit.id}, #{exhibit.is_published == 1 ? 0 : 1});", :class => 'nav_link' %>
<% end  -%>
		</div>
	</div>
	<div class="exhibit_sharing">
		<span class="exhibit_profile_label">Creative Commons License:</span>
		<div>
			<% if Group.can_change_license(exhibit) -%>
			<div class="exhibit_preview_thumbnail"><%= link_to_function("#{exhibit.get_sharing_image()}", "license_dialog({ populateLicenses: '/my_collex/get_licenses?add_inherit=false', selection: #{exhibit.get_sharing_int()}, id_name: 'sharing', id: #{exhibit.id}, update_id: 'overview_data', sub_title: 'Share this exhibit under the following license:', callback_url: '/my_collex/change_sharing' }); return false;") %></div>
			<span id="overview_published" class="overview_field"><%= "Creative Commons' #{exhibit.get_sharing()} License" %>
			</span>
			<%= link_to_function("[Choose License]", "license_dialog({ populateLicenses: '/my_collex/get_licenses?add_inherit=false', selection: #{exhibit.get_sharing_int()}, id_name: 'sharing', id: #{exhibit.id}, update_id: 'overview_data', sub_title: 'Share this exhibit under the following license:', callback_url: '/my_collex/change_sharing' }); return false;", { :class => "modify_link" }) %>
			<% else -%>
			<div class="exhibit_preview_thumbnail"><%= exhibit.get_sharing_image() %></div>
			<span id="overview_published" class="overview_field"><%= "Creative Commons' #{exhibit.get_sharing()} License" %>
			</span>
			<br />[The license is set by the group.]
			<% end -%>
		</div>
	</div>
	<div class="clear_both"></div>
</div>
