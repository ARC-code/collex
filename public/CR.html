<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html lang="en">
<!--THIS IS A GENERATED FILE. DO NOT EDIT--><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Algorithm for Recognizing Canonical References</title>
<link rel="stylesheet" type="text/css" href="tei.css">
<meta xmlns:html="http://www.w3.org/1999/xhtml" name="DC.Title" content="Algorithm for Recognizing Canonical References">
<meta xmlns:html="http://www.w3.org/1999/xhtml" name="DC.Language" content="(SCHEME=iso639) en">
<meta xmlns:html="http://www.w3.org/1999/xhtml" name="DC.Creator" content="TEI,Oxford University Computing Services, 13 Banbury Road, Oxford OX2 6NN, United Kingdom">
<meta xmlns:html="http://www.w3.org/1999/xhtml" name="DC.Creator.Address" content="tei@oucs.ox.ac.uk">
</head>
<body background="background.gif">
<a name="TOP"></a><div class="teidiv">
<table class="header" width="100%">
<tr>
<td rowspan="3"><img src="jaco001d.gif" alt="" width="180"></td>
<td align="left"><h2 class="institution">Text Encoding Initiative</h2></td>
</tr>
<tr><td align="left">
<h3 class="subtitle">The XML Version of the TEI Guidelines</h3>
<h1 class="maintitle">32  Algorithm for Recognizing Canonical References</h1>
</td></tr>
</table>
<hr>
<p align="">
<i> Up: </i><a class="navlink" href="index.html">Contents</a><i> Previous: </i><a class="navlink" href="NH.html">31  Multiple Hierarchies</a><i> Next: </i><a class="navlink" href="REFCLA.html">33  Element Classes</a>
</p>
<table class="leftlinks"><tr>
<td width="15%" valign="top">
<p class="toc-left"><a class="toc-left" href="index.html">TEI P4 Home</a></p>
<hr>
<p class="toc-left"><a class="toc-left" href="CR.html">32  Algorithm for Recognizing Canonical References</a></p>
<hr>
<p class="toc-left"><a class="toc-left" href="dedication.html"> </a></p>
<p class="toc-left"><a class="toc-left" href="FM1.html"> Introductory Note (March 2002)</a></p>
<p class="toc-left"><a class="toc-left" href="AB.html">1  About These Guidelines</a></p>
<p class="toc-left"><a class="toc-left" href="SG.html">2  A Gentle Introduction to XML</a></p>
<p class="toc-left"><a class="toc-left" href="ST.html">3  Structure of the TEI Document Type Definition</a></p>
<p class="toc-left"><a class="toc-left" href="CH.html">4  Languages and Character Sets</a></p>
<p class="toc-left"><a class="toc-left" href="HD.html">5  The TEI Header</a></p>
<p class="toc-left"><a class="toc-left" href="CO.html">6  Elements Available in All TEI Documents</a></p>
<p class="toc-left"><a class="toc-left" href="DS.html">7  Default Text Structure</a></p>
<p class="toc-left"><a class="toc-left" href="PR.html">8  Base Tag Set for Prose</a></p>
<p class="toc-left"><a class="toc-left" href="VE.html">9  Base Tag Set for Verse</a></p>
<p class="toc-left"><a class="toc-left" href="DR.html">10  Base Tag Set for Drama</a></p>
<p class="toc-left"><a class="toc-left" href="TS.html">11  Transcriptions of Speech</a></p>
<p class="toc-left"><a class="toc-left" href="DI.html">12  Print Dictionaries</a></p>
<p class="toc-left"><a class="toc-left" href="TE.html">13  Terminological Databases</a></p>
<p class="toc-left"><a class="toc-left" href="SA.html">14  Linking, Segmentation, and Alignment</a></p>
<p class="toc-left"><a class="toc-left" href="AI.html">15  Simple Analytic Mechanisms</a></p>
<p class="toc-left"><a class="toc-left" href="FS.html">16  Feature Structures</a></p>
<p class="toc-left"><a class="toc-left" href="CE.html">17  Certainty and Responsibility</a></p>
<p class="toc-left"><a class="toc-left" href="PH.html">18  Transcription of Primary Sources</a></p>
<p class="toc-left"><a class="toc-left" href="TC.html">19  Critical Apparatus</a></p>
<p class="toc-left"><a class="toc-left" href="ND.html">20  Names and Dates</a></p>
<p class="toc-left"><a class="toc-left" href="GD.html">21  Graphs, Networks, and Trees</a></p>
<p class="toc-left"><a class="toc-left" href="FT.html">22  Tables, Formulae, and Graphics</a></p>
<p class="toc-left"><a class="toc-left" href="CC.html">23  Language Corpora</a></p>
<p class="toc-left"><a class="toc-left" href="SH.html">24  The Independent Header</a></p>
<p class="toc-left"><a class="toc-left" href="WD.html">25  Writing System Declaration</a></p>
<p class="toc-left"><a class="toc-left" href="FD.html">26  Feature System Declaration</a></p>
<p class="toc-left"><a class="toc-left" href="TD.html">27  Tag Set Documentation</a></p>
<p class="toc-left"><a class="toc-left" href="CF.html">28  Conformance</a></p>
<p class="toc-left"><a class="toc-left" href="MD.html">29  Modifying and Customizing the TEI DTD</a></p>
<p class="toc-left"><a class="toc-left" href="IN.html">30  Rules for Interchange
 </a></p>
<p class="toc-left"><a class="toc-left" href="NH.html">31  Multiple Hierarchies</a></p>
<p class="toc-left-this"><a class="toc-left-this" href="CR.html">32  Algorithm for Recognizing Canonical References</a></p>
<p class="toc-left"><a class="toc-left" href="REFCLA.html">33  Element Classes</a></p>
<p class="toc-left"><a class="toc-left" href="REFENT.html">34  Entities</a></p>
<p class="toc-left"><a class="toc-left" href="REFTAG.html">35  Elements</a></p>
<p class="toc-left"><a class="toc-left" href="DT.html">36  Obtaining the TEI DTD</a></p>
<p class="toc-left"><a class="toc-left" href="XW.html">37  Obtaining TEI WSDs</a></p>
<p class="toc-left"><a class="toc-left" href="XT.html">38  Sample Tag Set Documentation
 </a></p>
<p class="toc-left"><a class="toc-left" href="GR.html">39  Formal Grammar for the TEI-Interchange-Format Subset of SGML</a></p>
<p class="toc-left"><a class="toc-left" href="P2BIB.html">Appendix A  Bibliography</a></p>
<p class="toc-left"><a class="toc-left" href="PARTIND.html">Appendix B  Index</a></p>
<p class="toc-left"><a class="toc-left" href="PREFS.html">Appendix C  Prefatory Notes</a></p>
<p class="toc-left"><a class="toc-left" href="P2COL.html">Appendix D  Colophon</a></p>
</td>
<td width="85%" valign="top">
<blockquote><i>This chapter makes extensive use of the
TEI Extended Pointer Notation, and may therefore be revised to discuss
use of XPath syntax as a preferable alternative at the next release.</i></blockquote>
<p>When a canonical reference is to be automatically processed
according to this method, the following occurs:
</p>
<ol>
<li>The reference is analysed into a series of component
targets, using the <tt><b>delim</b></tt> and <tt><b>length</b></tt>
attributes on the <a name="GDX-3139"></a><b><tt>&lt;step&gt;</tt></b> elements within the relevant
<a name="GDX-3140"></a><b><tt>&lt;refsDecl&gt;</tt></b>, as described below. The target from the first
<a name="GDX-3141"></a><b><tt>&lt;step&gt;</tt></b> element is made available for use in the
subsequent pointer processing as %1, that from the second
as %2, and so on. The number of targets N must be noted,
as it will be used in later steps of the algorithm. (Targets
with numbers greater than N may be referenced, but they will be
null strings.)
 </li>
<li>Starting at the root of the tree (i.e. the <a name="GDX-3142"></a><b><tt>&lt;text&gt;</tt></b>
element, for a TEI-conformant document), a search is made
following the specifications of the pointer in the first
<a name="GDX-3143"></a><b><tt>&lt;step&gt;</tt></b> element: its <tt><b>from</b></tt> and <tt><b>to</b></tt>
attributes are processed exactly as would be done with an
<a name="GDX-3144"></a><b><tt>&lt;xptr&gt;</tt></b> element.
 </li>
<li>If there are more targets to be located, the search
continues by following the pointer specifications in the next
<a name="GDX-3145"></a><b><tt>&lt;step&gt;</tt></b> element, using as location source the span located
by the previous <a name="GDX-3146"></a><b><tt>&lt;step&gt;</tt></b>. Except for this special location
source, the processing is still identical to that done for an
<a name="GDX-3147"></a><b><tt>&lt;xptr&gt;</tt></b> element. (Note that this does not prevent an
expansion of the location source at any step, either by using
keywords such as <tt><b>previous</b></tt> which search outside the
location source, or by an explicit return to <tt><b>root</b></tt>.)
 </li>
<li>When N <a name="GDX-3148"></a><b><tt>&lt;step&gt;</tt></b> elements have been processed, the
search is complete. The final result of the reference is a point
or span of text, as with extended pointers.
 </li>
</ol>
<p>
Note that there is no backtracking or other attempt at recovery
if a pointer fails. It is instead possible to design the
pointers so that backtracking is not necessary: see the final
example below.</p>
<p>When analyzing a reference into component targets, the following
procedure is adopted for each <a name="GDX-3149"></a><b><tt>&lt;step&gt;</tt></b> element that is
used:
</p>
<ol>
<li>If only the <tt><b>length</b></tt> attribute is specified,
exactly that number of characters is taken from the reference.
Entity references are resolved before characters are counted.
(This implies that references containing entity references may
behave differently on different systems.)
 </li>
<li>If only the <tt><b>delim</b></tt> attribute was specified,
every character up to the next occurrence of the specified
delimiter is taken from the reference, and the delimiter itself
is removed.
 </li>
<li>If both <tt><b>length</b></tt> and <tt><b>delim</b></tt> attributes
are specified, a test is made for the presence of the delimiter
in the reference string immediately following the specified
number of characters; if this test fails, the reference fails.
 </li>
<li>If neither <tt><b>length</b></tt> nor <tt><b>delim</b></tt>
attribute is specified, the remainder of the reference string is
taken. This should happen only for the last <a name="GDX-3150"></a><b><tt>&lt;step&gt;</tt></b> in a
<a name="GDX-3151"></a><b><tt>&lt;refsDecl&gt;</tt></b>.
 </li>
<li>The number of components resulting from this procedure
must not exceed the number of steps in the associated
declaration, but may be less than it. (For example, a long poem
might be divided into cantos and lines, but a reference can
point to either a line in a canto or to a whole canto; a
reference to a whole canto would not require the <a name="GDX-3152"></a><b><tt>&lt;step&gt;</tt></b>
for the line number.)
 </li>
</ol>
<p></p>
<p>
<a name="id3201048"></a>Here is an example of how a reference system for an encoding of
the Bible could be specified:
<pre class="eg">&lt;refsDecl&gt;
   &lt;step refunit=&quot;book&quot;    delim=&quot; &quot; from=&quot;CHILD (1 DIV N %1)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;chapter&quot; delim=&quot;:&quot; from=&quot;CHILD (1 DIV N %2)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;verse&quot;   delim=&quot;&quot;  from=&quot;CHILD (1 DIV N %3)&quot; to=&quot;DITTO&quot;/&gt;
&lt;/refsDecl&gt;</pre>
With this reference declaration, a canonical reference of the
form &#8216;Matt 5:7&#8217; is processed by first searching for the
<a name="GDX-3153"></a><b><tt>&lt;div&gt;</tt></b> subelement of the <a name="GDX-3154"></a><b><tt>&lt;text&gt;</tt></b> element with an
<tt><b>n</b></tt> attribute having value <tt>Matt</tt>; then searching
within that <a name="GDX-3155"></a><b><tt>&lt;div&gt;</tt></b> element for a <a name="GDX-3156"></a><b><tt>&lt;div&gt;</tt></b> subelement
with an <tt><b>n</b></tt> attribute having value <tt>5</tt>; and
finally for a further nested <a name="GDX-3157"></a><b><tt>&lt;div&gt;</tt></b> element numbered
<tt>7</tt>. This example assumes that the unnumbered <a name="GDX-3158"></a><b><tt>&lt;div&gt;</tt></b>
elements nevertheless follow a predictable hierarchy: the first
level is always for books, the second for chapters, and the
third for verses. The following reference declaration would
allow intermediate <a name="GDX-3159"></a><b><tt>&lt;div&gt;</tt></b> elements of any sort, because it
would search at each step not only for the right <tt><b>n</b></tt>
attribute but also for a <tt><b>type</b></tt> attribute identifying
the structural type of the division:
<pre class="eg">&lt;refsDecl&gt;
   &lt;step refunit=&quot;book&quot;    delim=&quot; &quot;
      from=&quot;DESCENDANT (1 DIV N %1 TYPE BOOK)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;chapter&quot; delim=&quot;:&quot;
      from=&quot;DESCENDANT (1 DIV N %2 TYPE CHAPTER)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;verse&quot;   delim=&quot;&quot;
      from=&quot;DESCENDANT (1 DIV N %3 TYPE VERSE)&quot; to=&quot;DITTO&quot;/&gt;
&lt;/refsDecl&gt;</pre>
 </p>
<p>
<a name="id3201215"></a>Other reference systems depend on markers such as page and line
numbers which do not correspond to structural divisions of the
text. These will typically be marked in the text by milestone
elements which identify single points in the text, rather than
by structural elements which contain the portion of the text to
be located. It is then necessary to construct extended pointers
in the reference declaration that can locate both the start and
the end of any segment. Here is a reference declaration for a
work whose reference system consists of page and line numbers:
for example, &#8216;93.3&#8217;.
<pre class="eg">&lt;refsDecl&gt;
   &lt;step refunit=&quot;page&quot; delim=&quot;.&quot; from=&quot;FOLLOWING (1 PB N %1)&quot; to=&quot;FOLLOWING (1 PB)&quot;/&gt;
   &lt;step refunit=&quot;line&quot; delim=&quot;&quot; from=&quot;FOLLOWING (1 LB N %2)&quot; to=&quot;FOLLOWING (1 LB)&quot;/&gt;
&lt;/refsDecl&gt;</pre>
To locate the specified page, the application must first search
for the first <a name="GDX-3160"></a><b><tt>&lt;pb&gt;</tt></b> element with <tt><b>n</b></tt> equal to
<tt>93</tt>. It must then find the end of that page, which it does
by searching for the next <a name="GDX-3161"></a><b><tt>&lt;pb&gt;</tt></b> element after that for the
start of page 93; this should mark the start of page 94. A
similar procedure is used within the page to find the
<a name="GDX-3162"></a><b><tt>&lt;lb&gt;</tt></b> elements that mark the start and end of the desired
line.</p>
<p>
<a name="id3201301"></a>A reference system may combine elements of the last two
approaches: a reference system based on line numbers is normally
used for early English plays, but because such plays often
combine prose and verse the line numbers sometimes refer to
structural elements (for verse passages) and sometimes to
arbitrary typographical boundaries (for prose). One could simply
fill the entire text with milestones, even in the verse passages
which do not require them; but a reference declaration can also
be constructed which requires no superfluous elements. Here is
such a declaration for a collection of plays, and for canonical
references of the form &#8216;Changeling 1.2.44&#8217;.
<pre class="eg">&lt;refsDecl&gt;
   &lt;step refunit=&quot;work&quot;  delim=&quot; &quot;
      from=&quot;DESCENDANT (1 TEXT N %1)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;act&quot;   delim=&quot;.&quot;
      from=&quot;CHILD (1 DIV1 N %2)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;scene&quot; delim=&quot;.&quot;
      from=&quot;CHILD (1 DIV2 N %3)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;line&quot;  delim=&quot;&quot;
      from=&quot;FOLLOWING (1 (L|LB) N %4)&quot; to=&quot;FOLLOWING (1 (L|LB))&quot;/&gt;
&lt;/refsDecl&gt;</pre>
Instead of using the CHILD or DESCENDANT keywords to locate the
<a name="GDX-3163"></a><b><tt>&lt;l&gt;</tt></b> elements in verse passages, we use FOLLOWING, which
works to locate <a name="GDX-3164"></a><b><tt>&lt;lb&gt;</tt></b> elements as well.</p>
<p>
<a name="id3201364"></a>The algorithm also allows ambiguity in the reference, as a
substitute for requiring backtracking in the processing.
Consider the following reference declaration for a text
containing several works:
<pre class="eg">&lt;refsDecl&gt;
   &lt;step refunit=&quot;work&quot; delim=&quot; &quot; from=&quot;DESCENDANT (ALL TEXT N %1)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;book&quot; delim=&quot;.&quot; from=&quot;CHILD (1 DIV1 N %2)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;poem&quot; delim=&quot;.&quot; from=&quot;CHILD (1 DIV2 N %3)&quot; to=&quot;DITTO&quot;/&gt;
   &lt;step refunit=&quot;line&quot; delim=&quot;&quot; from=&quot;CHILD (1 L N %4)&quot; to=&quot;DITTO&quot;/&gt;
&lt;/refsDecl&gt;</pre>
Given the canonical reference <tt>Amores I.2</tt>, the application
will first search for all <a name="GDX-3165"></a><b><tt>&lt;text&gt;</tt></b> elements whose
<tt><b>n</b></tt> attribute has the value <tt>Amores</tt>. This creates
a location source for the second step consisting of one or more
<a name="GDX-3166"></a><b><tt>&lt;text&gt;</tt></b> elements, possibly discontiguous; at the second
step, all the <a name="GDX-3167"></a><b><tt>&lt;div1&gt;</tt></b> elements numbered <tt>I</tt> within
those <a name="GDX-3168"></a><b><tt>&lt;text&gt;</tt></b> elements are selected. At the third, the
contained <a name="GDX-3169"></a><b><tt>&lt;div2&gt;</tt></b> elements numbered <tt>2</tt> are selected,
and the search ends because the reference string is exhausted:
it points to a whole poem, not to a single line. This reference
declaration is designed for use with a text that contains
several works, some of which might have the same name, so that
at the first step it is not adequate to search merely for the
first <a name="GDX-3170"></a><b><tt>&lt;text&gt;</tt></b> called <tt>Amores</tt>. It may be that several
works called <tt>Amores</tt> exist but only one has a book
numbered <tt>I</tt>, so that at the second step the location
source narrows down to the one work desired. In other approaches
to this problem, the works called <tt>Amores</tt> would be treated
one at a time, and if one turned out not to be the one desired
backtracking to previous steps of the search would be required;
this reference-processing method uses composite location sources
instead to eliminate the need for backtracking.</p>
</td>
</tr></table>
<p align="">
<i> Up: </i><a class="navlink" href="index.html">Contents</a><i> Previous: </i><a class="navlink" href="NH.html">31  Multiple Hierarchies</a><i> Next: </i><a class="navlink" href="REFCLA.html">33  Element Classes</a>
</p>
<hr>
<div class="footer">
<a class="plain" target="_top" href=""></a>
| <a class="plain" target="_top" href="http://www.tei-c.org/">TEI Home</a>
</div>
<hr>
<address>  edited by C M Sperberg-McQueen and Lou Burnard.
 <br>Copyright TEI Consortium 2003<!--
Generated  using an XSLT version 1.0 stylesheet
based on http://www.oucs.ox.ac.uk/stylesheets/teihtml.xsl
processed using libxslt
on 2003-03-17T12:06:06+01:00-->
</address>
</div>
</body>
</html>
