<style media="all" type="text/css">
	table {
		border-collapse: collapse;
		border: 1px solid #CCC;
		font-family: Verdana, Arial, Helvetica, sans-serif;
		font-size: 9pt;
		line-height: normal;
		width: 900px;
	}

	th {
		text-align: center;
		border-top: 1px solid #FB7A31;
		border-bottom: 1px solid #FB7A31;
		background: #FFC;
		padding: 0.3em;
		border-left: 1px solid silver;
	}

	tr.break td {
		border: 0;
		border-top: 1px solid #FB7A31;
		padding: 0;
		margin: 0;
	}

	tr.method td {
		font-weight: bold;
	}
	td.method_name {
		width: 200px;
	}

	td {
		padding: 0.3em;
	}

	td:first-child {
		width: 190px;
	}

	td {
		border-left: 1px solid #CCC;
		text-align: center;
	}	
	#browser_profile {
		width: 920px;    
		margin: 0 auto;
	}  

</style>
<div id="browser_profile">
	<h1>Profile Report</h1>
	<br/><br/>
	<table>
		<tr><th>Column</th><th>Description</th></tr>
		<tr><td>%self</td><td>The percentage of time spent in this method, derived from self_time/total_time</td></tr>
		<tr><td>cumulative</td><td>The sum of the time spent in this method and all the methods listed above it.</td></tr>
		<tr><td>total</td><td>The time spent in this method and its children.</td></tr>
		<tr><td>self</td><td>The time spent in this method.</td></tr>
		<tr><td>children</td><td>The time spent in this method's children.</td></tr>
		<tr><td>calls</td><td>The number of times this method was called.</td></tr>
		<tr><td>self/call</td><td>The average time spent per call in this method.</td></tr>
		<tr><td>total/call</td><td>The average time spent per call in this method and its children.</td></tr>
		<tr><td>name</td><td>The name of the method.</td></tr>
	</table>
	<br/><br/>
	<!-- Threads Table -->
	<table>
		<tr>
			<th>Thread ID</th>
			<th>Total Time</th>
		</tr>
		<% for thread_id, methods in sort_threads(@result.threads) %>
		<tr>
			<td><a class="thread" href="#<%= thread_id %>"><%= thread_id %></a></td>
			<td><%= @result.toplevel(thread_id).total_time %></td>
		</tr>
		<% end %>
	</table>
	<!-- Methods Tables -->
	<% for thread_id, methods in sort_threads(@result.threads) %>
	<h2><a name="<%= thread_id %>">Thread <%= thread_id %></a></h2>
	<h3>Minimum Elapsed Time for a task <%= MIN_THREAD_TIME %> </h3>

	<table>
		<tr>
			<th><%= sprintf("%#{PERCENTAGE_WIDTH}s", "%Total") %></th>
			<th><%= sprintf("%#{PERCENTAGE_WIDTH}s", "%Self") %></th>
			<th><%= sprintf("%#{TIME_WIDTH}s", "Total") %></th>
			<th><%= sprintf("%#{TIME_WIDTH}s", "Self") %></th>
			<th><%= sprintf("%#{TIME_WIDTH+2}s", "Children") %></th>
			<th><%= sprintf("%#{CALL_WIDTH}s", "Calls") %></th>
			<th>Name</th>
		</tr>

		<% sort_methods(methods).each do |pair| %>
		<% name = pair[0] %>
		<% method = pair[1] %>
		<% method_total_percent = self.total_percent(method) %>
		<% next if method_total_percent < @min_percent %>
		<% method_self_percent = self.self_percent(method) %>

		<!-- Parents -->
		<% for name, call_info in sort_methods(method.parents) %> 
		<tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", call_info.total_time) %></td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", call_info.self_time) %></td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", call_info.children_time) %></td>
			<% called = "#{call_info.called}/#{method.called}" %>
			<td><%= sprintf("%#{CALL_WIDTH}s", called) %></td>
			<td class="method_name"><%= create_link(thread_id, name) %></td>
		</tr>
		<% end %>

		<tr class="method">
			<td><%= sprintf("%#{PERCENTAGE_WIDTH-1}.2f\%", method_total_percent) %></td>
			<td><%= sprintf("%#{PERCENTAGE_WIDTH-1}.2f\%", method_self_percent) %></td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", method.total_time) %></td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", method.self_time) %></td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", method.children_time) %></td>
			<td><%= sprintf("%#{CALL_WIDTH}i", method.called) %></td>
			<td class="method_name"><a name="<%= link_name(thread_id, method.name) %>"><%= method.name %></a></td>
		</tr>

		<!-- Children -->
		<% for name, call_info in sort_methods(method.children) %> 
		<% methods = @result.threads[thread_id] %>
		<% child = methods[name] %>

		<tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", call_info.total_time) %></td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", call_info.self_time) %></td>
			<td><%= sprintf("%#{TIME_WIDTH}.2f", call_info.children_time) %></td>
			<% called = "#{call_info.called}/#{child.called}" %>
			<td><%= sprintf("%#{CALL_WIDTH}s", called) %></td>
			<td class="method_name"><%= create_link(thread_id, name) %></td>
		</tr>
		<% end %>
		<!-- Create divider row -->
		<tr class="break"><td colspan="7"></td></tr>
		<% end %>
	</table>
	<% end %>
</div>

